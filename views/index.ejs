<!DOCTYPE html>
<html>
<head>
    <title><%= title %></title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.css" />
    <!--[if lte IE 8]><link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.ie.css" /><![endif]-->

    <link rel="stylesheet" href="../stylesheets/leaflet-sidebar.css" />

    <style>
        body {
            padding: 0;
            margin: 0;
        }
        html, body, #map {
            height: 100%;
            font: 10pt "Helvetica Neue", Arial, Helvetica, sans-serif;
        }
        .lorem {
            font-style: italic;
            color: #AAA;
        }
    </style>
</head>

<body onload="getLocation()">
    <div id="sidebar" class="sidebar collapsed">
        <!-- Nav tabs -->
        <div class="sidebar-tabs">
            <ul role="tablist">
                <li><a href="#home" role="tab"><i class="fa fa-bars"></i></a></li>
                <li><a href="#profile" role="tab"><i class="fa fa-user"></i></a></li>
                <% if (session.user.isAdmin) { %>
                  <li><a href="#device" role="tab"><i class="fa fa-heartbeat"></i></a></li>

                  <li><a href="#provider" role="tab"><i class="fa fa-shopping-cart"></i></a></li>
                <% } %>
                <li><a href="#api" role="tab"><i class="fa fa-html5"></i></a></li>
                <li><a href="#contact" role="tab"><i class="fa fa-envelope"></i></a></li>
                <li><a href="#chat" role="tab"><i class="fa fa-comment"></i></a></li>
            </ul>
                        <% if (session.user.isAdmin) { %>
                          <ul role="tablist">
                              <li><a href="#settings" role="tab"><i class="fa fa-gear"></i></a></li>
                          </ul>
                        <%}%>
        </div>

        <!-- Tab panes -->
        <div class="sidebar-content">
            <div class="sidebar-pane" id="home">
                <h1 class="sidebar-header">
                    geoDESA
                    <div class="sidebar-close"><i class="fa fa-caret-left"></i></div>
                </h1>
                <br>
                <p> Web para la gestión y geolocalización de Desfibriladores Externos SemiAutomáticos (DESA) o Desfibriladores Externos Automáticos (DEA) <!--<a href="http://leafletjs.com/">Leaflet</a> or <a href="http://openlayers.org/">OpenLayers</a>-->.</p>

                <p class="lorem">El desfibrilador externo semiautomático (DESA) o desfibriliador externo automático (DEA), es un aparato electrónico portátil (producto sanitario) que diagnostica y trata la parada cardiorrespiratoria cuando es debida a la fibrilación ventricular (en que el corazón tiene actividad eléctrica pero sin efectividad mecánica) o a una taquicardia ventricular sin pulso (en que hay actividad eléctrica y en este caso el bombeo sanguíneo es ineficaz), restableciendo un ritmo cardíaco efectivo eléctrica y mecánicamente. La desfibrilación consiste en emitir un impulso de corriente continua al corazón, despolarizando simultáneamente todas las células miocárdicas, pudiendo retomar su ritmo eléctrico normal u otro eficaz. La fibrilación ventricular es la causa más frecuente de muerte súbita.</p>

                <p class="lorem">El DESA o DEA es muy eficaz para la mayor parte de los llamados paros cardíacos, que en su mayor parte son debidos a que el corazón fibrila y su ritmo no es el adecuado, estos equipos básicamente devuelven el ritmo adecuado al corazón, pero es totalmente ineficaz en la parada cardíaca con asistolia pues el corazón, en este caso, además de no bombear la sangre, no tiene actividad eléctrica; y en la actividad eléctrica sin pulso (AESP), antes denominada disociación electromecánica, donde hay actividad eléctrica, que puede ser incluso normal, pero sin eficacia mecánica. En estos dos últimos casos únicamente se debe realizar compresión torácica mientras se establecen otras medidas avanzadas.</p>

            </div>
            <!--Formulario de autenticación de usuarios registrados, y también pueden darse de alta con sing up-->
            <div class="sidebar-pane" id="profile">
                <h1 class="sidebar-header">Profile<div class="sidebar-close"><i class="fa fa-caret-left"></i></div></h1>
                <br>
                <div class="panel panel-info">
                  <%if (session.user == ""){ %>
                  <div class="panel-heading">
                    <h3 class="panel-title">Sign in</h3>
                  </div>
                  <div class="panel-body">
                    <form class="form-inline" action="/sessions/login" method="post">
                        <div class="form-group">
                          <label class="sr-only" for="login">Login</label>
                          <input type="text" class="form-control " id="login" name="login" placeholder="Login">
                        </div>
                        <br>
                        <div class="form-group">
                          <label class="sr-only" for="password">Password</label></br>
                          <input type="password" class="form-control" id="password" name="password" placeholder="Password">
                        </div>
                        <br>
                        <br>
                        <button type="submit" class="btn btn-info">Sign in</button>
                      </form>
                  </div>
                    <% } else { %>
                      <div class="panel-heading">
                        <h3 class="panel-title">User</h3>
                      </div>
                      <div class="panel-body">
                        <p>User: <%= session.user.username %></p>
                        <form action="/sessions/logout" method="get">
                          <button type="submit" class="btn btn-info">Log out</button>
                        </form>
                      </div>
                    <% } %>
                </div>
            </div>
            <div class="sidebar-pane" id="profile">
                <!--<h1 class="sidebar-header">Profile<div class="sidebar-close"><i class="fa fa-caret-left"></i></div></h1>-->
                <br>
                <div class="panel panel-info">
                  <div class="panel-body">
                    <p class="lorem">Para darse de alta, pulse sign up, y rellene el formulario para solicitarla.</p>
                    <form class="form-inline" action="/users/solicitudalta" method="get">
                        <br>
                        <br>
                        <button type="submit" class="btn btn-info">Sign up</button>
                      </form>
                  </div>



                </div>
            </div>
            <!--formulario de Devices -->
            <div class="sidebar-pane" id="device">
                <h1 class="sidebar-header">DEA / DESA<div class="sidebar-close"><i class="fa fa-caret-left"></i></div></h1>
                <br>
                <div class="panel panel-info">
                  <div class="panel-heading">
                    <h3 class="panel-title">New DEA/DESA</h3>
                  </div>
                  <div class="panel-body">
                    <p class="lorem">Introduzca la información del nuevo dispositivo</p>
                    <form class="form-inline" action="/create" method="post" enctype="multipart/form-data">
                      <div class="form-group">
                        <label class="sr-only" for="name">Descripción</label>
                        <input type="text" class="form-control " id="name" name="name" placeholder="Descripción">
                      </div>
                      <br>
                      <div class="form-group">
                        <label class="sr-only" for="address">Dirección</label>
                        <input type="text" class="form-control" id="address" name="address" placeholder="Dirección">
                      </div>
                      <br>
                      <div class="form-group">
                        <label class="sr-only" for="provider">Proveedor</label>
                        <input type="text" class="form-control" id="provider" name="provider" placeholder="Proveedor">
                      </div>
                      <br><br>
                      <div class="form-group">
                        <label class="sr-only" for="deviceType">Tipo de dispositivo</label>
                        <select class="form-control" id="deviceType">
                          <option>DEA</option>
                          <option>DESA</option>
                          <option>Desfibrilador</option>
                        </select>
                      </div>
                      <br><br>
                      <div class="form-group">
                        <label class="sr-only" for="location">localizacion</label>
                        <input type="text" class="form-control" id="location" name="location "placeholder="localizacion (lon,lat) __._,__._">
                      </div>
                      <br><br>
                      <div class="form-group">
                        <label for="imagen">Imagen</label><br>
                        <input type="file" class="form-control" id="imagen" placeholder="Imagen">
                      </div>
                      <br><br>
                      <button type="submit" class="btn btn-info">Enviar</button>
                    </form>
                  </div>
                </div>
            </div>
            <!--formulario de providers -->
            <div class="sidebar-pane" id="provider">
                <h1 class="sidebar-header">PROVIDERS<div class="sidebar-close"><i class="fa fa-caret-left"></i></div></h1>
                <br>
                <div class="panel panel-info">
                  <div class="panel-heading">
                    <h3 class="panel-title">New PROVIDER</h3>
                  </div>
                  <div class="panel-body">
                    <p class="lorem">Introduzca la información del nuevo proveedor</p>
                    <form class="form-inline" action="" method="post" enctype="multipart/form-data">
                      <div class="form-group">
                        <label class="sr-only" for="name">Nombre</label>
                        <input type="text" class="form-control " id="name" name="name" placeholder="Nombre">
                      </div>
                      <br>
                      <div class="form-group">
                        <label class="sr-only" for="address">Dirección</label>
                        <input type="text" class="form-control" id="address" name=" address" placeholder="Dirección">
                      </div>
                      <br>
                      <div class="form-group">
                        <label class="sr-only" for="cif">Cif</label>
                        <input type="text" class="form-control" id="cif" name="cif" placeholder="Cif">
                      </div>
                      <br>
                      <div class="form-group">
                        <label class="sr-only" for="phone">Teléfono</label>
                        <input type="text" class="form-control" id="phone" name="phone" placeholder="Teléfono">
                      </div>
                      <br>
                      <br><br>
                      <br><br>
                      <button type="submit" class="btn btn-info">Enviar</button>
                    </form>
                  </div>
                </div>
            </div>
            <!--Formulario APIDocs-->

            <div class="sidebar-pane" id="api">
                <h1 class="sidebar-header">API Docs<div class="sidebar-close"><i class="fa fa-caret-left"></i></div></h1>
                <br>
                <div class="panel panel-info">
                  <!-- Default panel contents -->
                  <div class="panel-heading">
                    <h3 class="panel-title">API Documentation</h3>
                  </div>
                  <div class="panel-body">
                    <p>Accede a la docuentación de la API, selecciona la entidad correspondiente</p>
                  </div>

                  <!-- Table -->
                  <table class="table">
                    <thead>
                      <tr>
                        <th>Entidad</th>
                        <th></th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr class="active">
                        <td>Sesiones</td>
                        <td><a href="#" class="btn btn-info btn-sm active" role="button">Session API Docs</a></td>
                      </tr>
                      <tr>
                        <td>Users</td>
                        <td><a href="#" class="btn btn-info btn-sm active" role="button">Users API Docs</a></td>
                      </tr>
                      <tr>
                        <td>Devices</td>
                        <td><a href="#" class="btn btn-info btn-sm active" role="button">Users Devices Docs</a></td>
                      </tr>
                      <tr>
                        <td>Providers</td>
                        <td><a href="#" class="btn btn-info btn-sm active" role="button">Providers API Docs</a></td>
                      </tr>
                    </tbody>
                  </table>
                </div>
            </div>


            <div class="sidebar-pane" id="contact">
                <h1 class="sidebar-header">Contacto<div class="sidebar-close"><i class="fa fa-caret-left"></i></div></h1>
                <br>
                <div class="panel panel-info">
                  <div class="panel-heading">
                    <h3 class="panel-title">Contacta con nosotros</h3>
                  </div>
                  <div class="panel-body">
                    <p class="lorem">Póngase en contacto con nosotros para cualquier duda, queja o sugerencia.</p>
                    <form class="form-inline">
                      <div class="form-group">
                        <label class="sr-only" for="nombreApellidos">Nombre y Apellidos</label>
                        <input type="text" class="form-control" id="nombreApellidos" placeholder="Nombre y Apellidos">
                      </div>
                      <br>
                      <div class="form-group">
                        <label class="sr-only" for="email">Email</label>
                        <input type="email" class="form-control" id="email" placeholder="Email">
                      </div>
                      <br><br>
                      <div class="form-group">
                        <label class="sr-only" for="texto">texto</label>
                        <textarea class="form-control" rows="7" placeholder="escribe tu duda, queja o sugerencia, GRACIAS"></textarea>
                      </div>

                      <br><br>
                      <button type="submit" class="btn btn-info">Enviar</button>
                    </form>
                  </div>
                </div>
            </div>
            <!--icono para chatear con el centro coordinador.-->
            <div class="sidebar-pane" id="chat">
                <h1 class="sidebar-header">Chat<div class="sidebar-close"><i class="fa fa-phone-alt"></i></div></h1>
                <br>
                <div class="panel panel-info">
                  <div class="panel-heading">
                    <h3 class="panel-title">Chatear con el 061</h3>
                  </div>
                  <div class="panel-body">
                    <p class="lorem">Chatear con el centro de emergencias 061 </p>
                    <form class="form-inline">
                      <div class="form-group">
                        <label class="sr-only" for="nombre">Nombre</label>
                        <input type="text" class="form-control" id="nombre" placeholder="Nombre">
                      </div>
                      <br>
                      <br><br>
                      <div class="form-group">
                        <label class="sr-only" for="texto">texto</label>
                        <textarea class="form-control" rows="7" placeholder="escribe tu duda, queja o sugerencia, GRACIAS"></textarea>
                      </div>

                      <br><br>
                      <button type="submit" class="btn btn-info">Enviar</button>
                    </form>
                  </div>
                </div>
            </div>
            <div class="sidebar-pane" id="settings">
                <h1 class="sidebar-header">Settings<div class="sidebar-close"><i class="fa fa-caret-left"></i></div></h1>
                <div class="panel panel-info">
                  <div class="panel-body">
                    <p class="lorem">User operations</p>
                    <form class="form-inline" action="/users/list" method="get">
                        <br>
                        <br>
                          <button type="submit" class="btn btn-info">Users</button>
                      </form>
                  </div>
                </div>
                <div class="panel panel-info">
                  <div class="panel-body">
                    <p class="lorem">Device operations</p>
                    <form class="form-inline" action="/devices/list" method="get">
                        <br>
                        <br>
                          <button type="submit" class="btn btn-info">Devices</button>
                      </form>
                  </div>
                </div>
                <div class="panel panel-info">
                  <div class="panel-body">
                    <p class="lorem">Provider operations</p>
                    <form class="form-inline" action="/providers/list" method="get">
                        <br>
                        <br>
                          <button type="submit" class="btn btn-info">Providers</button>
                      </form>
                  </div>
                </div>
            </div>
        </div>
    </div>

    <div id="map" class="sidebar-map"></div>



    <!--<a href="https://github.com/Turbo87/sidebar-v2/"><img style="position: fixed; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"></a>-->

    <!-- <a ><img style="position: fixed; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"></a> -->
    <!--muestra el icono del mundo para geolocalizacion de los desa o dea mas cercanos a nuestra posicion.-->

       <!--geolocalizacion de la posicion-->

    <script src="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.js"></script>
    <script src="../js/leaflet-sidebar.js"></script>
    <!-- Icono del mundo a la derecha arriba.-->
    <a href="http://localhost:3000/" role="tab"><i style="position: fixed; top: 40px; right: 40px; border: 40px; width: 40px; heigth:40px" class="fa fa-globe fa-3x"></i>></a>


    <script>
    //definimos variable para el icono
    var personIcon = L.icon({
        iconUrl: './images/person.png',
        //shadowUrl: './images/person.png',

        iconSize:     [38, 55], // size of the icon
        //shadowSize:   [50, 64], // size of the shadow
        iconAnchor:   [22, 94], // point of the icon which will correspond to marker's location
        //shadowAnchor: [4, 62],  // the same for the shadow
        popupAnchor:  [-3, -76] // point from which the popup should open relative to the iconAnchor
    });

    //geolocalizacion de la posicion

        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(showPosition);
            } else {
                alarm ("No soporta geolocalización");
            }
        }


        function showPosition(position) {

          geoPositionLat = position.coords.latitude;
          geoPositionLon = position.coords.longitude;

          var map = L.map('map');
          map.setView([geoPositionLat, geoPositionLon], 8, {icon: personIcon});
          L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
              maxZoom: 18,
              attribution: 'Map data &copy; OpenStreetMap contributors'
          }).addTo(map);

          var posiciones = {pos:0.1, pos2:0.2, pos3:0.3};

          // marcamos nuestra posicion L.marker([lat, long], zoom, {icon:icono})
          var marker = L.marker([geoPositionLat, geoPositionLon],{icon: personIcon}).addTo(map);
          for (var posicion in posiciones) {
            var nuevaMarca =  L.marker([geoPositionLat+posiciones[posicion], geoPositionLon]).addTo(map);
          }

          // Mostrar listado de posiciones de deispositivos cercanoss
          // a nuestra posicion actual
          var sidebar = L.control.sidebar('sidebar').addTo(map);

        }
    </script>

</body>
</html>
